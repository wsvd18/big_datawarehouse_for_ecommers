建表语句
hive -e "
CREATE TABLE IF NOT EXISTS dwd.dwd_fac_order_detailinfo_di (
    id STRING,
    order_amount DOUBLE,
    sku_num BIGINT,
    ds STRING,
    order_status STRING,
user_id bigint,
sku_id string,
province_id bigint
)
PARTITIONED BY (create_time STRING)
ROW FORMAT DELIMITED
FIELDS TERMINATED BY '\t';"



#!/bin/bash

# DWD

# 设置 Hive 动态分区模式
hive -e "
set hive.exec.dynamic.partition=true;
set hive.exec.dynamic.partition.mode=strict;
set hive.exec.max.dynamic.partitions.pernode=1000;

# 建立无分区但包含分区字段的临时表 (2023-04-01改成 cast(date_sub(current_date,1) as string) 就是动态分区)

CREATE TABLE IF NOT EXISTS dwd.temp_order_data AS
SELECT 
    t1.id,
    t1.original_total_amount AS order_amount,
    t2.sku_num,
    substr(t1.create_time, 1, 10) AS ds,
    t1.order_status,
    substr(t1.create_time, 1, 10) AS create_time,
    t1.user_id,
    t2.sku_id,
    t1.province_id
FROM
    tempo.order_info t1
JOIN
    tempo.order_detail t2
ON
    t1.id = t2.order_id
WHERE
    t1.create_time LIKE '2023-04-01%';

# 临时表导入分区表时建立分区

INSERT OVERWRITE TABLE dwd.dwd_fac_order_detailinfo_di PARTITION (create_time='2023-04-01')
SELECT
    id,
    order_amount,
    sku_num,
    ds,
    order_status,
    user_id,
    sku_id,
    province_id
FROM
    dwd.temp_order_data
WHERE
    ds='2023-04-01';

# 删除临时表
DROP TABLE IF EXISTS dwd.temp_order_data;"
echo "完成"
